# MySQL

- Relational database management system.
- Databases are often stored in a single file with a `.sql` extension.

**MySQL Clients**
- Can edit database via queries done in the SQL database language.
- Wordpress is a CMS that uses MySQL for storing posts, usernames and passwords.

**MySQL Databases**
- Used in dynamic websites as LAMP or LEMP stacks.

#### Default Configuration
![[2023-03-20 15_24_06-Hack The Box - Academy.png|700]]

#### Dangerous Settings
![[2023-03-20 15_24_49-Hack The Box - Academy.png|700]]
- The user, password, and admin_address settings are plain text. If the permissions are not set correctly on this file we can read them easily.
- The MySQL docs have a section on common [security issues](https://dev.mysql.com/doc/refman/8.0/en/general-security-issues.html)

#### Footprinting MySQL

Usually TCP port 3306

- **Nmap**
	- `sudo nmap 10.129.14.128 -sV -sC -p3306 --script mysql*`
	- Manually confirm scanned info because of false positives.
- **MySQL Client**
	- `mysql -u <user> -p<password> -h <IP>`
		- The most important databases are:
			- System schema (sys)
			- Information schema (information_schema)
![[2023-03-20 15_36_16-Hack The Box - Academy.png|700]]

___
# MSSQL
- Used with .NET apps.
- Mostly found on Windows

#### MSSQL Clients
- [SQL Server Management Studio](https://docs.microsoft.com/en-us/sql/ssms/download-sql-server-management-studio-ssms?view=sql-server-ver15) (SSMS) is a client application to manage databaases.
- Because it can be installed anywhere, we may come across a vulnerable system with saved SSMS credentials.
- [mssql-cli](https://docs.microsoft.com/en-us/sql/tools/mssql-cli?view=sql-server-ver15)
- [SQL Server PowerShell](https://docs.microsoft.com/en-us/sql/powershell/sql-server-powershell?view=sql-server-ver15)
- [HediSQL](https://www.heidisql.com/)
- [SQLPro](https://www.macsqlclient.com/)
- [Impacket's mssqlclient.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/mssqlclient.py)

#### MSSQL Databases
![[2023-03-20 16_29_22-Hack The Box - Academy.png|700]]

#### Default Configuration
- Initially the SQL server will likely run as `NT SERVICE\MSSQLSERVER`
- Connecting from the client-side is possible through Windows Authentication. By default encryption is not enforced.
	- Windows Authentication means the OS will process the login request and use the local SAM database or the domain controller (if AD) before allowing the connection. 

#### Dangerous Settings
This is not an extensive list because there are countless ways MSSQL databases can be configured by admins based on the needs of their respective organizations. We may benefit from looking into the following:

-   MSSQL clients not using encryption to connect to the MSSQL server
-   The use of self-signed certificates when encryption is being used. It is possible to spoof self-signed certificates   
-   The use of [named pipes](https://docs.microsoft.com/en-us/sql/tools/configuration-manager/named-pipes-properties?view=sql-server-ver15)
-   Weak & default `sa` credentials. Admins may forget to disable this account

#### Footprinting MSSQL
- Default port TCP 1433

- **NMAP MSSQL Script Scan**
	- `sudo nmap --script ms-sql-info,ms-sql-empty-password,ms-sql-xp-cmdshell,ms-sql-config,ms-sql-ntlm-info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes --script-args mssql.instance-port=1433,mssql.username=sa,mssql.password=,mssql.instance-name=MSSQLSERVER -sV -p 1433 <IP>`

- **MSSQL Ping in Metasploit**
	- Use `scanner/mssql/mssql_ping` to get basic information on the service.

- **Connecting with Mssqlclient.py**
	- If we have credentials we can connect and start interacting with databases using T-SQL.
	- `python3 mssqlclient.py Administrator@<IP> -windows-auth`