 
![[2023-03-16 17_49_09-Hack The Box - Academy.png|700]]

- Mainly unencrypted
	- For encryption:
		- DNS over TLS (DoT)
		- DNS over HTTPS (DoH)
- Also NSCrypt encrypts traffic between a client and name server.

DNS Record | Description
--|--
A | IPv4 address
AAAA | IPv6 address
MX | Mail Server
NS | DNS / Name Server
TXT | Various. Can be used to validate the google search console, validate SSL certs, etc. Also, SPF and DMARC entries are set to validate mail traffic and prevent spam.
CNAME | Alias that also points to the same address
PTR | Reverse Lookup. Converts IPs to domain names
SOA | Info about the DNS zone and email of the admin contact. 

#### Default Configuration
All DNS servers work with three different types of config files:
1. Local DNS configuration files
2. Zone files
3. Reverse name resolution files

- Bind9 DNS server is over used on linux distros.
	- The local config (named.conf) is divided into two sections
		1. A section for general settings
		2. Zone entries for the individual domains
	- Local config files are usually:
		- `named.conf.local`
		- `named.conf.options`
		- `named.conf.log`
	
- `named.conf.local` is used to define the different zones. The zones are divided into individual files.
![[2023-03-16 18_02_10-Hack The Box - Academy.png|700]]
- Zone files are text files that describe a DNS zone with the BIND file format.
	- A zone requires _exactly one_ SOA record and _at least one_ NS record.
![[2023-03-16 18_04_49-Hack The Box - Academy.png|700]]

- For an IP to be resolved from the Fully Qualified Domain Name (FQDN) the DNS server must have a lookup file
- The computer name ==(FQDN) is assigned to the last octet of an IP==, which corresponds to a host, using a PTR record.
![[2023-03-16 18_07_57-Hack The Box - Academy.png|700]]

#### Dangerous Settings
[Most popular DNS attacks](https://securitytrails.com/blog/most-popular-types-dns-attacks)
Option | Description
--------|---------
allow-query | Who is allowed to send requests to the DNS server
allow-recursion| Who is allowed to send recursive requests
allow-transfer | Who is allowed to receive zone transfers
zone-statistics | Collects statistical data of zones

#### Footprinting DNS
- **Dig - NS Query**
	- DNS servers can be queried as to which other name servers are known.
	- We do this using the _NS record_ and the specification of the DNS server we want to query using the `@` character.
		- `dig ns <FQDN.com> @<NS IP>`
			- ex: `dig ns inlanefreight.htb @10.129.14.128`
- **Dig - Version Query**
	- Sometimes it is possible to query a DNS server's version using a class CHAOS query and type TXT.
		- `dig CH TXT version.bind <DNS IP>`
- **Dig - ANY Query**
	- View all available records that the server is willing to disclose
	- Not all entries from the zones will be shown.
		- `dig any <FQDN> @<DNSIP>`
- **Dig - AXFR Zone Transfer**
	- Used to maintain exact data on multiple name servers
	- Transfer of zones from master to slave server over port 53
	- Secured via the secret key: rndc-key which is set in the config files.
	- Original data is located on a primary name server and replicated to secondary name server
		- DNS entries and generally only modified on the primary.
		- Servers that serve as a direct source for synchronizing a zone file are called a master
		- Servers that obtain zone data from a master is called a slave.
			- A primary is always a master.
			- A secondary can be a slave and master.
	- The slave fetches the zone's SOA at intervals called refresh time which is usually one hour. It compares serial numbers. If the serial number of the SOA record of the master is greater than that of the slave the data sets no longer match.
		- `dig axfr <FQDN> @<DNSIP>`
			- If the administrator used a subnet for the `allow-transfer` option for testing purposes or as a workaround solution or set it to `any`, everyone would query the entire zone file at the DNS server. In addition, other zones can be queried, which may even show internal IP addresses and hostnames.
- **Subdomain BruteForcing**
	- One liner:
		- `for sub in $(cat /home/wallace/fierce-hostlist.txt );do dig $sub.dev.inlanefreight.htb @10.129.56.155 | grep -v ';\|SOA' | sed -r '/^\s*$/d' | grep $sub | tee -a subdomains2.txt;done`
	-  [DNSenum](https://github.com/fwaeytens/dnsenum) will brute force a list of possible subdomains against the DNS server to see if there are any matches
		- `dnsenum --dnsserver 10.129.14.128 --enum -p 0 -s 0 -o subdomains.txt -f /opt/useful/SecLists/Discovery/DNS/subdomains-top1million-110000.txt inlanefreight.htb`