# RDP
- Remote Desktop Protocol
- Allows display and control commands to be transmitted via the GUI encrypted over IP networks.
- For RDP, the network and server firewalls must allow connections from the outside.
	- IF NAT is used the remote computer needs the public IP address to reach the server along with correctly forwarded ports.
- RDP has TLS/SSL however, many Windows systems accept inadequate encryption via RDP security.
- Port 3389

## Footprinting RDP

#### Nmap
- `sudo nmap -sV -sC <IP> -p3389 --script rdp*`
- `nmap -sV -sC <IP> -p3389 --packet-trace --disable-arp-ping -n
	- The RDP cookies used by Nmap to interact with RDP can be picked up by threat hunters or EDR.

#### [RDP Security Check](https://github.com/CiscoCXSecurity/rdp-sec-check)
- Setup:
	- `sudo cpan`
	- `git clone https://github.com/CiscoCXSecurity/rdp-sec-check.git && cd rdp-sec-check`
- `./rdp-sec-check.pl <IP>` - checks RDP security unauthenticated

## Connecting

#### xfreerdp
- `xfreerdp /u:user /p:password /v:<IP>`
- Options:
	- `/dynamic-resolution` -- allows us to resize the window, adjusting the resolution of the target in the process
	- `/size:WIDTHxHEIGHT` -- sets a specific size for targets that don't resize automatically with /dynamic-resolution
	- `+clipboard` -- enables clipboard support
	- `/drive:LOCAL_DIRECTORY,SHARE_NAME` -- creates a shared drive between the attacking machine and the target. This switch is insanely useful as it allows us to very easily use our toolkit on the remote target, and save any outputs back directly to our own hard drive. In essence, this means that we never actually have to create any files on the target. For example, to share the current directory in a share called share, you could use: /drive:.,share, with the period (.) referring to the current directory When creating a shared drive, this can be accessed either from the command line as `\\\\tsclient\\`, or through File Explorer under "This PC"

___
# WinRM
- Simple command line based remote management.
- WinRM must be explicitly enabled and configured for Windows 10 and later.
- Uses port 5985 for HTTP and 5986 for HTTPS

#### Nmap WinRM
- `nmap -sV -sC 10.129.201.248 -p5985,5986 --disable-arp-ping -n`
	- Often we will see that HTTPS is not used.

#### Test if Server Can be Reached via WinRM (Windows)
- The [Test-WsMan](https://docs.microsoft.com/en-us/powershell/module/microsoft.wsman.management/test-wsman?view=powershell-7.2) cmdlet is responsible for this, and the host's name in question is passed to it.

#### [Evil-WinRM](https://github.com/Hackplayers/evil-winrm)
- `evil-winrm -i <IP> -u user -p password`

- More Evil-WinRM [[Evil winrm|details]].

___

# WMI
- Windows Management Instrumentation
	- Allows read/write access to almost all settings on Windows.
- Typically accessed via PowerShell, VBScript, or WMI console (WMIC)
- WMi is not a single program but consists of serverl programs and various databases also known as repositories.
- Connnection is established on TCP port 135 and then moved to a random port,

#### WMIexec.py
- `/usr/share/doc/python3-impacket/examples/wmiexec.py user:"password"@<IP> "hostname"`
