## Basics
- DNS is mainly UDP/53 but will rely on TCP/53 more heavily as time progresses

## Enumeration
[[DNS|Full DNS Enumeration Notes]]
``` bash
nmap -p53 -Pn -sV -sC 10.10.110.213
```

### DNS Zone Transfer
- An abusable misconfiguration that allows us to dump the entire DNS namespaces from a vulnerable server
``` bash
dig AXFR @ns1.inlanefreight.htb inlanefreight.htb
```
- Tools like [Fierce](https://github.com/mschwager/fierce) can also be used to enumerate all DNS servers of the root domain and scan for a DNS zone transfer
``` bash
fierce --domain zonetransfer.me
```

## Domain Takeovers & Subdomain Enumeration

- Domain takeover is registering a non-existtent domain name to gain control over another domain. If attackers find an expired domain, they can claim that domain to perform further attacks.
- Subdomain takeover is similiar. The subdomain name uses a CNAME record to another domain. If the other domain expires it can be claimed and complete control can be had over the target subdomain until DNS is updated.
- [Subdomain takeover examples](https://hackerone.com/hacktivity?querystring=%22subdomain%20takeover%22)

#### Subdomain Enumeration
- [DNSdumpster](https://dnsdumpster.com/)
- Subfinder
- Sublist3r
- [Subbrute](https://github.com/TheRook/subbrute) - Allows us to use self defined resolvers and perform DNS brute forcing atttacking on hosts that do not have internet access.

![[2023-04-04 16_50_00-Hack The Box - Academy.png|700]]

- The [can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz) repository is also an excellent reference for a subdomain takeover vulnerability

## DNS Spoofing
- Aka DNS Cache Poisoning
	- Involves alerting legitimate DNS records with false information so they can be used to redirect traffic to a fradulent website.
#### Local DNS Cache Poisoning
- Local Poisoning can be done using MITM tools like [Ettercap](https://www.ettercap-project.org/) or [Bettercap](https://www.bettercap.org/).
- In Ettercap
	- First edit `/etc/ettercap/etter.dns` to map the target domain name to spoof and the attacking IP address that traffic should be redirected to.![[2023-04-04 16_53_37-Hack The Box - Academy.png|500]]
	- Then, start ettercap and scan for live hosts by navigating to `Hosts > Scan for Hosts`
		- Once completed add the target IP address to Target 1 and add a default gateway to Target 2
		- Activate `dns_spoof` by going to `Plugins > Manage Plugins`. This will send the target machine fake dns responses