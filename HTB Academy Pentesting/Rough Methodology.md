# External

## Basic recon
- Nmap scan of scope
	- `sudo nmap --open -oA inlanefreight_ept_tcp_1k -iL scope`
- Aggressive Nmap scan all ports all hosts in scope
	- `sudo nmap --open -p- -A -oA inlanefreight_ept_tcp_all_svc -iL scope`
- If DNS present attempt zone transfer or other subdomain enumeration
	- `dig axfr inlanefreight.local @10.129.203.101`
- If no DNS enumerate vHosts with [[12. ffuf#Vhost Fuzzing|ffuf]]
- Add discovered hosts to `/etc/hosts`

## Service Enumeration & Exploitation
- Go through each service and check for misconfigurations or vulnerabilities

## Web Enumeration & Exploitation

During an External Penetration Test, we will perform `cursory` web application testing, looking for high-risk vulnerabilities. If we don't have many findings at all, we can dig into the web applications deeper, and we can always include a catch-all `Best Practice Recommendation` or `Informational` finding that lists out several common security-related HTTP response header issues that we see all the time, among other minor issues. This way, we've fulfilled the contract by going after the big issues such as SQL injection, unrestricted file upload, XSS, XXE, file inclusion attacks, command injections, etc., but covered ourselves with the informational finding in case the client comes back asking why we didn't report X.

- Use [[01. Application Discovery & Enumeration#Using EyeWitness|EyeWitness]] to screenshot each web application then work through them on at a time.
``` bash
eyewitness -f subdomain.list -d eyewitness_output_folder
```

srvadm:ILFreightnixadm!

Once a foothold and persistence are established:

## Set up Pivoting

- If msf was used use [[03. Meterpreter Tunneling & Port Forwarding#Creating Routes with AutoRoute|post/multi/manage/autoroute]] 
- Use proxychains if using an SSH tunnel

## Host Discovery

- MSF - `post/multi/gather/ping_sweep`
- SSH Tunnel - `for i in $(seq 254); do ping 172.16.8.$i -c1 -W1 & done | grep from`
	- Doing a sweep from the attack box via nmap is very slow

## Host enumeration
- Upload nmap onto the foothold machine
	- `./nmap --open -iL live_hosts `

## AD Quick Hits - SMB NULL SESSION

We can quickly check against the Domain Controller for [[05. Enumerating & Retrieving Password Policies#Enumerating the Password Policy from Linux - SMB NULL Sessions|SMB NULL Sessions]]. If we can dump the password policy and a user list via [[05. Enumerating & Retrieving Password Policies#Using enum4linux-ng|enum4linux]], we could try a measured password spraying attack. If we know the password policy, we can time our attacks appropriately to avoid account lockout. 

If we can't find anything else, we could come back and use [[Kerbrute]] to enumerate valid usernames from various user lists and after enumerating (during a real pentest) potential usernames from the company's LinkedIn page. With this list in hand, we could try 1-2 spraying attacks and hope for a hit. 

If that still does not work, depending on the client and assessment type, we could ask them for the password policy to avoid locking out accounts. We could also try an [[22. Miscellaneous Misconfigurations#ASREPRoasting|ASREPRoasting]] attack if we have valid usernames.


## Listen on the Wire
- It can be useful to listen on the wire via `tcpdump` whenever possible during an internal pentest. This can uncover cleartext credentials or other useful information.
	- We'll typically do this during an Internal Penetration Test when we have our own physical laptop or a VM that we control inside the client's network.
- We can write the tcpdump to a file and transfer it to the attack box and examine it via wireshark.
	- `tcpdump -i ens192 -s 65535 -w ilfreight_pcap`

`backupadm:!qazXSW@`
`ilfserveradm:Sys26Admin`
