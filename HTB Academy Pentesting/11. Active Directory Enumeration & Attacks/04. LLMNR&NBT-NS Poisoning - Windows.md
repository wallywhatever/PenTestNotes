## [Inveigh](https://github.com/Kevin-Robertson/Inveigh)[(wiki)](https://github.com/Kevin-Robertson/Inveigh/wiki/Parameters)
- Inveigh works similar to Responder but is written in PowerShell and C#.
- Inveigh can listen to IPv4 and IPv6 and several other protocols, including `LLMNR`, DNS, `mDNS`, NBNS, `DHCPv6`, ICMPv6, `HTTP`, HTTPS, `SMB`, LDAP, `WebDAV`, and Proxy Auth.

#### Using Inveigh
``` Powershell
Import-Module .\Inveigh.ps1
(Get-Command Invoke-Inveigh).Parameters # lists parameters
```

#### Inveigh for LLMNR and NBNS Spoofing
``` PowerShell
Invoke-Inveigh Y -NBNS Y -ConsoleOutput Y -FileOutput Y
```
![[inveigh_pwsh.gif|700]]

## C# Inveigh (InveighZero)
- The Powershell version is the original and is no longer updated
	- The tool author maintains the C# version, which combines the original PoC C# code and a C# port of most of the code from the PowerShell version.
- Before we can use the C# version, we have to compile the exe in Visual Studio. (That process was not covered in the module)

``` Powershell
.\Inveigh.exe
```
![[2023-04-18 16_02_09-Hack The Box - Academy.png|700]]
- Enabled/disabled options are visibile with `[+]`/`[ ]`
- Press `ESC` to enter/exit the console
	- `HELP` - shows options available
	- `GET NTLMV2UNIQUE` - shows unique captured hashes
	- `GET NTLMV2USERNAMES` - shows collected usernames


# Remediation
- Mitre ATT&CK technique [ID: T1557.001](https://attack.mitre.org/techniques/T1557/001), `Adversary-in-the-Middle: LLMNR/NBT-NS Poisoning and SMB Relay`.
- LLMNR and NBT-NS can be disabled.
	- LLMNR in Group Policy by going to Computer Configuration --> Administrative Templates --> Network --> DNS Client and enabling "Turn OFF Multicast Name Resolution."
	- NBT-NS can't be done via GPO so its a bit more complicated
-  [Blog Post](https://www.praetorian.com/blog/a-simple-and-effective-way-to-detect-broadcast-name-resolution-poisoning-bnrp/) on detection methods.